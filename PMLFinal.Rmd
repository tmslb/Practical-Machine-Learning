---
## Practical Machine Learning
## R Code
---

library(Hmisc)</br>
library(caret)</br>
library(randomForest)</br>
library(foreach)</br>
library(doParallel)</br>
set.seed(2048)</br></br>

training_data <- read.csv("pml-training.csv", na.strings=c("#DIV/0!") )</br>
evaluation_data <- read.csv("pml-testing.csv", na.strings=c("#DIV/0!") )</br>

for(i in c(8:ncol(training_data)-1)) {training_data[,i] = as.numeric(as.character(training_data[,i]))}</br></br>

for(i in c(8:ncol(evaluation_data)-1)) {evaluation_data[,i] = as.numeric(as.character(evaluation_data[,i]))}</br>

feature_set <- colnames(training_data[colSums(is.na(training_data)) == 0])[-(1:7)]</br>
model_data <- training_data[feature_set]</br>
feature_set</br>

idx <- createDataPartition(y=model_data$classe, p=0.75, list=FALSE )</br>
training <- model_data[idx,]</br>
testing <- model_data[-idx,]</br>

registerDoParallel</br>
x <- training[-ncol(training)]</br>
y <- training$classe</br>

rf <- foreach(ntree=rep(150, 6), .combine=randomForest::combine, .packages='randomForest') %dopar% {
  randomForest(x, y, ntree=ntree) 
}</br>

predictions1 <- predict(rf, newdata=training)</br>
confusionMatrix(predictions1,training$classe)</br>


predictions2 <- predict(rf, newdata=testing)</br>
confusionMatrix(predictions2,testing$classe)</br>


pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}</br>


x <- evaluation_data</br>
x <- x[feature_set[feature_set!='classe']]</br>
answers <- predict(rf, newdata=x)</br>

answers</br>

pml_write_files(answers)</br>
